import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

import { loginWithPassword  } from "@evex/linejs";

const server = new McpServer({
  name: "line-mcp",
  version: "0.1.0"
});

const client = await loginWithPassword({  
    email: 'nezowarui0504@yahoo.co.jp',
    password: 'usd1.6180339887',
    onPincodeRequest(_) {
    }  
  }, { device: "DESKTOPWIN" });

server.registerTool("get_users",
  {
    title: "Get Users",
    description: "Get Users",
    inputSchema: {}
  },
  async () => {
    const users = await client.fetchUsers();
    return {
      content: [{ type: "text", text: JSON.stringify(users) }]
    };
  }
);

const transport = new StdioServerTransport();
await server.connect(transport);